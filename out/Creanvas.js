var f=f||{};f.a=f.a||{};window.CreJs=f;f.Creanvas=f.a;(function(){var a=f.n=f.n||{};a.p=function(d,e,k){var b=this;this.t=d;this.u=e;this.W=k||0;this.Da=function(d){return{O:a.qa(b,d.O),q:a.qa(b,d.q),Ma:a.qa(b,d.Ma)}}};Object.defineProperty(a.p.prototype,"x",{get:function(){return this.t},set:function(a){this.t=a}});Object.defineProperty(a.p.prototype,"y",{get:function(){return this.u},set:function(a){this.u=a}});Object.defineProperty(a.p.prototype,"z",{get:function(){return this.W},set:function(a){this.W=a}});a.Za=function(d,e,k,b){d=k-d;e=b-e;b=Math.sqrt(d*
d+e*e);return{O:new a.p(d/b,e/b,0),q:new a.p(-e/b,d/b,0),Ma:new a.p(0,0,0)}};a.qb=function(a,e,k,b,h){a.lineWidth=5;a.strokeStyle=h;a.beginPath();a.moveTo(e,k);a.lineTo(e+100*b.O.t,k+100*b.O.u);a.moveTo(e,k);a.lineTo(e+50*b.q.t,k+50*b.q.u);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};a.pb=function(a,e,k,b,h,l,n){a.lineWidth=5;a.strokeStyle=n;a.beginPath();a.moveTo(e,k);a.lineTo(e+100*h*b.O.t,k+100*h*b.O.u);a.lineTo(e+100*h*b.O.t+100*l*b.q.t,k+100*h*b.O.u+100*l*b.q.u);a.stroke();a.lineWidth=1;a.strokeStyle=
"#000"};a.qa=function(a,e){return a.t*e.t+a.u*e.u};a.ia=function(d,e){return new a.p(d.u*e.W-d.W*e.u,d.W*e.t-d.t*e.W,d.t*e.u-d.u*e.t)};f.Core=f.n;f.n.Vector=f.n.p})();f.a.Na=function(a){function d(){return a.elements.filter(function(a){return a.ca})}function e(a,h,d){var e,c,m,g,k,p;e=d.nb;g=new f.n.p(d.x-a.i,d.y-a.j);k=f.n.ia(g,e.q).z;p=new f.n.p(d.x-h.i,d.y-h.j);d=f.n.ia(p,e.q).z;var r=f.n.ia(g,e.q),q=f.n.ia(p,e.q);c=new f.n.p(a.b.d.x,a.b.d.y);m=new f.n.p(h.b.d.x,h.b.d.y);a.r&&(c.x+=g.x*a.r.x,c.y+=g.y*a.r.y);h.r&&(m.x+=p.x*h.r.x,m.y+=p.y*h.r.y);g=a.ca.wa*h.ca.wa*2*(m.Da(e).q-c.Da(e).q+h.b.G*q.z-a.b.G*r.z)/(1/h.M+1/a.M+q.z*q.z/h.fa()+r.z*r.z/a.fa());a.b.d.x+=
g/a.M*e.q.x;a.b.d.y+=g/a.M*e.q.y;h.b.d.x-=g/h.M*e.q.x;h.b.d.y-=g/h.M*e.q.y;a.b.G+=g*k/a.fa();h.b.G-=g*d/h.fa()}function k(a,h){var e,d,c,m,g,k,p;m=a.Ca();g=h.Ca();e=Math.max(m.left,g.left)-1;d=Math.min(m.right,g.right)+1;c=Math.max(m.top,g.top)-1;m=Math.min(m.bottom,g.bottom)+1;if(!(0>=d-e||0>=m-c)){e=a.f.getImageData(0,0,a.c,a.g);a.f.scale(1/(a.h||1),1/(a.l||1));a.f.rotate(-(a.m||0));a.f.translate(h.i-a.i,h.j-a.j);a.f.rotate(h.m||0);a.f.scale(h.h||1,h.l||1);a.f.globalCompositeOperation="destination-out";
a.f.drawImage(h.S.canvas,0,0,h.c,h.g,-h.v,-h.w,h.c,h.g);a.f.scale(1/(h.h||1),1/(h.l||1));a.f.rotate(-h.m||0);a.f.translate(-h.i+a.i,-h.j+a.j);a.f.rotate(a.m||0);a.f.scale(a.h||1,a.l||1);k=a.f.getImageData(0,0,a.c,a.g);a.f.globalCompositeOperation="source-over";a.f.putImageData(e,0,0);p=[];a.ya.forEach(function(g){90>k.data[g.y*a.c*4+4*g.x+3]&&p.push(g)});if(2>p.length)return null;var r;c=d=0;e=p.length-1;for(m=1;m<p.length;m++)for(g=m+1;g<p.length;g++){r=p[m].x-p[g].x;var q=p[m].y-p[g].y;r=Math.sqrt(r*
r+q*q);r>d&&(d=r,c=m,e=g)}d=a.ea(p[c].x-a.v,p[c].y-a.w);e=a.ea(p[e].x-a.v,p[e].y-a.w);return d.x==e.x&&d.y==e.y?null:{x:Math.round((d.x+e.x)/2),y:Math.round((d.y+e.y)/2),nb:f.n.Za(d.x,d.y,e.x,e.y)}}}this.kb=function(a){var h=d(),l,n,c;l=a.Ba();h=h.filter(function(c){var g;if(c.D===a.D||!(c.b.d.x||c.b.d.y||a.b.d.x||a.b.d.y||c.r||a.r))return!1;g=c.Ba();return Math.sqrt((l.x-g.x)*(l.x-g.x)+(l.y-g.y)*(l.y-g.y))>a.Ea()+c.Ea()?!1:!0});if(0==h.length)return!0;n=null;h.forEach(function(e){n||(n=k(a,e))&&
(c=e)});if(!n)return!0;e(a,c,n);a.k.J("collision",{element:c,Sa:n});c.k.J("collision",{element:a,Sa:n});return!1}};f.a.Oa=function(a){var d,e,k,b,h,l,n,c;b=this;d=a.canvas;n=a.timeScale||1;c=a.meterPerPoint||1;a.xb?(l=Date.now(),this.getTime=function(){return(Date.now()-l)*n}):(h=0,setInterval(function(){h+=10*n},10),this.getTime=function(){return h});this.R=function(b){a.log&&a.log(b)};b.C=d.getContext("2d");b.C.scale(1/c,1/c);e=!0;isDrawing=!1;k=a.refreshTime||50;this.ta=function(a,g){var c=!1;b.elements.filter(function(g){return g.Ra(a)}).sort(function(a,g){return g.U||0-a.U||0}).forEach(function(b){!c&&b.ab(g.x,
g.y)&&(b.k.J(a,g),c=!0)})};this.La=function(a,g){b.elements.forEach(function(b){b.H==g.H&&b.k.J(a,g)})};this.pa=function(a,g){d.addEventListener(a,function(a){setTimeout(function(){if(a.changedTouches)for(var c=0;c<a.changedTouches.length;c++){var e=a.changedTouches[c].identifier,d=b.V(a.changedTouches[c]);d.H=e;b.ta(g,d)}else c=b.V(a),c.H=-1,b.ta(g,c)})})};this.ha=function(a,g){d.addEventListener(a,function(a){setTimeout(function(){if(a.changedTouches)for(var c=0;c<a.changedTouches.length;c++){var e=
a.changedTouches[c].identifier,d=b.V(a.changedTouches[c]);d.H=e;b.La(g,d)}else c=b.V(a),c.H=-1,b.La(g,c)})})};this.k=new f.X.ka;this.pa("click","click");this.pa("mousedown","pointerDown");this.pa("touchstart","pointerDown");this.ha("mousemove","pointerMove");this.ha("touchmove","pointerMove");this.ha("mouseup","pointerUp");this.ha("touchend","pointerUp");this.lb=function(){b.k.J("deactivate");b.elements=[]};this.I=function(){e=!0};this.V=function(a){var g=d.getBoundingClientRect();b.R("ClientXY: ("+
a.clientX+","+a.clientY+")");g={x:Math.round((a.clientX-g.left)*d.width/g.width*c),y:Math.round((a.clientY-g.top)*d.height/g.height*c)};b.R("canvasXY: ("+g.x+","+g.y+")");"click"==a.type&&b.R("Click on ! canvasXY: ("+g.x+","+g.y+")");return g};b.elements=[];this.add=function(){var a=[].slice.call(arguments),g=new f.a.Qa(b,a[0]);1<a.length&&g.ba.apply(g,a.slice(1));b.elements.push(g);return g};b.R("Adding background");this.add({Q:"background",L:{Z:d.width,Y:d.height,Ga:{ra:0,sa:0},Fa:a.drawBackground||
function(c){c.fillStyle=a.backgroundStyle||"#FFF";c.fillRect(0,0,d.width,d.height)}},Aa:{Ha:-Infinity}});setInterval(function(){e&&!isDrawing?(isDrawing=!0,b.elements.sort(function(a,g){return(a.U||0)-(g.U||0)}).forEach(function(a){b.C.translate(a.i,a.j);b.C.rotate(a.m||0);b.C.scale(a.h||1,a.l||1);b.C.drawImage(a.N.canvas,0,0,a.c,a.g,-a.v,-a.w,a.c,a.g);b.C.scale(1/(a.h||1),1/a.l||1);b.C.rotate(-(a.m||0));b.C.translate(-a.i,-a.j)}),isDrawing=!1):b.R("No redraw")},k);this.addElement=function(){var a=
[].slice.call(arguments),g=a[0];a[0]={Q:g.name,L:g.image?{Z:g.image.width,Y:g.image.height,Fa:g.image.draw,Ga:g.image.translate?{ra:g.image.translate.dx,sa:g.image.translate.dy}:null}:null,Aa:g.position?{gb:g.position.x||0,hb:g.position.y||0,Ha:g.position.z||0}:null,rules:g.rules};return this.add.apply(this,a)};this.redraw=this.I;this.stop=this.lb};f.a.Controller=f.a.Oa;f.a.Qa=function(a,d){this.Q=d.Q;var e=d.L,k=e.Fa,b=d.Aa,h=d.rules,l=[].slice.apply(arguments).slice(2),n=[];this.o=a;this.D=f.ja.la();this.c=e.Z;this.g=e.Y;this.i=b.gb||0;this.j=b.hb||0;this.U=b.Ha||0;this.m=b.wb||0;this.h=e.sb||1;this.l=e.tb||1;this.M=1;b=e.Ga||{ra:e.Z/2,sa:e.Y/2};this.v=b.ra;this.w=b.sa;e.ib?(this.L=e.ib,b=this.o.C.canvas,b=b.ownerDocument.createElement("canvas"),this.N=b.getContext("2d"),this.N.putImageData(this.L,0,0)):(b=this.o.C.canvas,b=b.ownerDocument.createElement("canvas"),
b.width=e.Z,b.height=e.Y,this.N=b.getContext("2d"),this.N.beginPath(),this.N.translate(this.v,this.w),k(this.N),this.L=this.N.getImageData(0,0,e.Z,e.Y));var c=this;h&&(c.rules=[],h.forEach(function(a){var b=c.rules.length;c.rules.push(a);setInterval(function(){c.rules[b].rule.call(c);c.I()},a.checkTime)}));this.k=new f.X.ka;this.isPointInPath=function(a){a=c.o.V(a);return c.o.vb.isPointInPath(c,k,a)};0<l.length&&f.a.e&&c.ba(l);this.ab=function(a,b){var e=Math.round(a-c.i+c.v),d=Math.round(b-c.j+c.w);
return 0<=e&&e<=c.c&&0<=d&&d<=c.g&&0<c.L.data[4*d*c.c+4*e+3]};this.va=function(a){e.rb=c.L;var b=c.o.add(d),h=a?l.filter(function(b){return a.every(function(a){return a!=b[0]})}):l;b.ba.apply(b,h);return b};this.jb=function(a){(a=f.a.e[a])&&a.Ia&&a.Ia(c)};this.Ra=function(a){return"click"==a||"pointerDown"==a||c.k.$a(a)};this.Ta=function(){c.o.k.removeEventListener({s:c.D});c.N=null};c.o.k.B({eventId:"deactivate",listenerId:c.D,handleEvent:function(){c.Ta()}});this.I=function(){c.o.I()};this.ea=function(a,
b){return{x:Math.round(c.i+a*c.h*Math.cos(c.m)-b*c.l*Math.sin(c.m)),y:Math.round(c.j+a*c.h*Math.sin(c.m)+b*c.l*Math.cos(c.m))}};this.Ba=function(){return c.ea(-c.v+c.c/2,-c.w+c.g/2)};var m=[];m.push({x:-c.v,y:-c.w});m.push({x:-c.v+c.c,y:-c.w});m.push({x:-c.v+c.c,y:-c.w+c.g});m.push({x:-c.v,y:-c.w+c.g});this.Xa=function(){return m.map(function(a){return c.ea(a.x,a.y)})};this.Wa=function(){var a=c.i+""+c.j+""+c.m+""+c.h+""+c.h;if(n.getClientCorners&&n.getClientCorners.key==a)return n.getClientCorners.value;
var b=c.Xa();n.getClientCorners={key:a,value:b};return b};this.Ya=function(){var a=c.Wa();return{top:a.reduce(function(a,b){return Math.min(a,b.y)},Infinity),bottom:a.reduce(function(a,b){return Math.max(a,b.y)},-Infinity),left:a.reduce(function(a,b){return Math.min(a,b.x)},Infinity),right:a.reduce(function(a,b){return Math.max(a,b.x)},-Infinity)}};this.Ca=function(){var a=c.i+""+c.j+""+c.m+""+c.h+""+c.h;if(n.getClientRect&&n.getClientRect.key==a)return n.getClientRect.value;var b=c.Ya();n.getClientRect=
{key:a,value:b};return b};this.ba=function(){var a=this,b=[].slice.apply(arguments);l=l.concat(b);b.forEach(function(b){a.na(b[0],b[1])})};this.na=function(a,b){var c=f.a.e[a];c&&c.P(this,b)};Object.defineProperty(c,"name",{get:function(){return this.Q},set:function(a){this.Q=a}});Object.defineProperty(c,"width",{get:function(){return this.c},set:function(a){this.c=a}});Object.defineProperty(c,"height",{get:function(){return this.g},set:function(a){this.g=a}});Object.defineProperty(c,"scaleX",{get:function(){return this.h},
set:function(a){this.h=a}});Object.defineProperty(c,"scaleY",{get:function(){return this.l},set:function(a){this.l=a}});Object.defineProperty(c,"x",{get:function(){return this.i},set:function(a){this.i=a}});Object.defineProperty(c,"y",{get:function(){return this.j},set:function(a){this.j=a}});Object.defineProperty(c,"z",{get:function(){return this.U},set:function(a){this.U=a}});Object.defineProperty(c,"angle",{get:function(){return this.m},set:function(a){this.m=a}});Object.defineProperty(c,"mass",
{get:function(){return this.M},set:function(a){this.M=a}});Object.defineProperty(c,"id",{get:function(){return this.D}});Object.defineProperty(c,"image",{get:function(){return this.L}});Object.defineProperty(c,"events",{get:function(){return this.k}});c.clone=c.va;c.applyDecorator=c.na;c.applyDecorators=c.ba;c.removeDecorator=c.jb};f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];f.a.e.clickable={P:function(a,d){var e=d.onclick;a.fb=function(d){e.call(a,d);a.I()};a.k.B({F:"click",handleEvent:a.fb})}};f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];
f.a.e.collidable={P:function(a,d){var e=[];a.ca={};var k=d.onCollision,b=d.coefficient;a.o.xa=a.o.xa||new f.a.Na(a.o);a.ca.wa=b||0===b?b:1;a.b=a.b||{d:new f.n.p(0,0),$:new f.n.p(0,0),G:0};a.k.B({F:"collision",handleEvent:function(b){k&&k.call(a,b)}});a.ga=this.ga||[];a.ga.push(function(){return a.o.xa.kb(a)});a.fa=function(){return a.M/12*(a.c*a.h*a.c*a.h+a.g*a.l*a.g*a.l)};a.Va=function(){return Math.sqrt(a.c*a.c*a.h*a.h+a.g*a.g*a.l*a.l)/2};a.Ea=function(){var b=a.c+""+a.g+""+a.h+""+a.l;if(e.getRadius&&
e.getRadius.key==b)return e.getRadius.mb;var c=a.Va();e.geRadius={ub:b,mb:c};return c};var h=a.o.C.canvas,b=h.ownerDocument.createElement("canvas"),h=h.ownerDocument.createElement("canvas");b.width=h.width=a.c;b.height=h.height=a.g;a.S=h.getContext("2d");a.S.putImageData(a.L,0,0);a.S.globalCompositeOperation="source-atop";a.S.fillStyle="#000";a.S.fillRect(0,0,a.c,a.g);a.f=b.getContext("2d");a.f.globalCompositeOperation="source-over";a.f.drawImage(a.S.canvas,0,0);b=a.f.getImageData(0,0,a.c,a.g);h=
a.f.createImageData(a.c,a.g);a.ya=[];for(var l=0;l<a.c;l++)for(var n=0;n<a.g;n++)if(!(200>b.data[n*a.c*4+4*l+3])){for(var c=!1,m=-1;2>m;m++)for(var g=-1;2>g;g++)if(0>n+m||0>l+g||n+m>a.g-1||l+m>a.c-1||100>b.data[(n+m)*a.c*4+4*(l+g)+3])c=!0,g=m=2;a.f.putImageData(h,0,0);c&&(a.ya.push({x:l,y:n}),h.data[n*a.c*4+4*l]=0,h.data[n*a.c*4+4*l+1]=0,h.data[n*a.c*4+4*l+2]=0,h.data[n*a.c*4+4*l+3]=255)}a.f.putImageData(h,0,0);a.f.translate(a.v,a.w)}};f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];f.a.e.droppable={P:function(a,d){var e=d.dropZone;a.cb=!0;a.za=e;Object.defineProperty(a,"dropZone",{get:function(){return this.za},set:function(a){this.za=a}})}};f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];f.a.e.dropzone={P:function(a,d){var e=d.availableSpots,k=d.dropX,b=d.dropY;a.da=[];a.k.B({A:"dropzone",F:"drop",handleEvent:function(d){0>=e||(e--,d.K.x=k||a.i,d.K.y=b||a.j,d.K.T=a,a.da.push(d.K),d.K.k.J("dropped",{T:a,K:d.K}),a.k.J("droppedIn",{T:a,K:d.K}),a.I())},s:a.D});a.Ua=function(b){b.T=null;e++;a.da.splice(a.da.indexOf(b),1);a.I()};Object.defineProperty(a,"droppedElements",{get:function(){return this.da}})}};f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];f.a.e.duplicable={P:function(a,d){var e=d.isBlocked,k=d.generatorCount||Infinity,b=!1;a.k.B({A:"duplicable",F:"pointerDown",handleEvent:function(d){0<=d.H&&(b=!0);if(!(b&&0>d.H||e&&e()||0>=k)){k--;var l=a.va(["duplicable"]);l.Q+=" (duplicate)";l.na("movable",{bb:e});l.Ka(d);a.I()}},s:a.D})},Ia:function(a){a.k.removeEventListener({A:"duplicable",s:a.D})}};f.a.e=f.a.e||[];f.a.elementDecorators=f.a.e;f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];
f.a.e.movable={P:function(a,d){var e=!1,k=this.H=null,b=d.bb;a.Ka=function(b){e=!0;a.H=b.H;k={x:b.x,y:b.y};a.T&&(a.T.Ua(a),a.T=null)};a.eb=function(b){e=!1;k=null;a.cb&&a.o.ta("drop",{x:b.x,y:b.y,K:a})};a.k.B({A:"movable",F:"pointerDown",handleEvent:function(d){b&&b()||a.Ka(d)},s:a.D});var h=!1;a.k.B({A:"movable",F:"pointerMove",handleEvent:function(d){!e||b&&b()||(h||(h=!0),a.i+=d.x-k.x,a.j+=d.y-k.y,k={x:d.x,y:d.y},a.I())},s:a.D});a.k.B({A:"movable",F:"pointerUp",handleEvent:function(d){!e||b&&b()||
(a.o.V(d),a.i+=d.x-k.x,a.j+=d.y-k.y,a.eb(d),a.H=null,h=!1,a.I())},s:a.D})}};f=f||{};f.a=f.a||{};f.a.e=f.a.e||[];
f.a.e.moving={type:"moving",P:function(a,d){var e,k,b,h,l,n=d.vx,c=d.vy,m=d.ax,g=d.ay,s=d.rotationSpeed,p,r,q;a.b=a.b||{};a.b.d=new f.n.p(n||0,c||0);a.b.$=new f.n.p(m||0,g||0);a.b.G=s||0;p=a.o.getTime();setInterval(function(){r=a.o.getTime();q=r-p;if(!(1>q)&&(p=r,a.b.d.x+=a.b.$.x*q,a.b.d.y+=a.b.$.y*q,0!=a.b.d.x||0!=a.b.d.y||0!=a.b.G||a.r&&(0!=a.r.x||0!=a.r.y))){e=a.i;k=a.j;b=a.m;h=a.h;l=a.l;a.i+=a.b.d.x*q;a.j+=a.b.d.y*q;a.m+=a.b.G*q;a.r&&(a.h+=a.r.x*q,a.l+=a.r.y*q);var c=!0;a.ga&&a.ga.forEach(function(b){c&&
(b.call(a)||(c=!1))});c||(a.i=e,a.j=k,a.m=b,a.h=h,a.l=l)}},20);Object.defineProperty(a,"moving",{get:function(){return this.b},set:function(a){this.b=a}});Object.defineProperty(a.b,"speed",{get:function(){return this.d},set:function(a){this.d=a}});Object.defineProperty(a.b,"acceleration",{get:function(){return this.$},set:function(a){this.$=a}});Object.defineProperty(a.b,"rotationSpeed",{get:function(){return this.G},set:function(a){this.G=a}});Object.defineProperty(a,"scaleSpeed",{get:function(){return this.r},
set:function(a){this.r=a}})}};(function(){var a=f.X=f.X||{},d;a.ua=function(a){this.F=a;d=f.ja;var k=[];this.J=function(b,h){d.la();var l=k.length;k.forEach(function(d){d.ob=a;setTimeout(function(){d.handleEvent(b);l--;0==l&&h&&h()})})};this.B=function(a){a.handleEvent=a.handleEvent||a.handleEvent;a.aa=a.aa||a.rank;a.s=a.s||a.listenerId;a.A=a.A||a.eventGroupType;var e=d.la();k.push({oa:e,handleEvent:a.handleEvent,aa:a.aa,s:a.s,A:a.A});k=k.sort(function(a,b){return(a.aa||Infinity)-(b.aa||Infinity)});return e};this.removeEventListener=
function(a){k=k.filter(function(d){return Boolean(a.oa)&&d.oa!=a.oa||Boolean(a.s)&&d.s!=a.s||Boolean(a.A)&&d.A!=a.A})}};f.Creevents=a;a.Event=a.ua})();(function(){var a=f.X=f.X||{};a.ka=function(){var d={},e=[];this.$a=function(a){return void 0!=d[a]};this.B=function(k){var b=k.F||k.eventId;d[b]||(e.push(b),d[b]=new a.ua(b));return d[b].B(k)};this.J=function(a,b,e){d[a]&&(b&&(b.F=a),d[a].J(b,e))};this.removeEventListener=function(a){d[a.F]?d[a.F].removeEventListener(a):e.forEach(function(b){d[b].removeEventListener(a)})};this.addEventListener=this.B};a.EventContainer=a.ka})();(function(){var a=f.ja=f.ja||{};a.la=function(){var d=Date.now().toString(16),d=a.Ja("x",15-d.length)+d;return("xxxxxxxx-xxxx-4xxx-y"+d.slice(0,3)+"-"+d.slice(3)).replace(/[xy]/g,function(a){var d=16*Math.random()|0;return("x"==a?d:d&3|8).toString(16)})};a.Ja=function(d,e){return 0>=e?"":d+a.Ja(d,e-1)}})();(function(){var a=f.Pa=f.Pa||{};a.ma=function(){this.R=function(a){console.log(a)}};f.Crelog=a;a.Logger=a.ma;a.ma.log=a.ma.R})();
