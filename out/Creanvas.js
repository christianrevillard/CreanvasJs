var TEST=!1,DEBUG=!1,CreJs=CreJs||{};CreJs.Creanvas=CreJs.Creanvas||{};(function(){var a=CreJs.Core=CreJs.Core||{};a.Vector=function(d,e,g){var f=this;this.x=d;this.y=e;this.z=g||0;this.draw=function(a,b,d,h){a.lineWidth=5;a.strokeStyle=h;a.beginPath();a.moveTo(b,d);a.lineTo(b+100*f.x,d+100*f.y);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};this.getCoordinates=function(c){return{u:a.scalarProduct(f,c.u),v:a.scalarProduct(f,c.v),w:a.scalarProduct(f,c.w)}};this.setCoordinates=function(a,b,d,h){h=h||0;f.x=b*a.u.x+d*a.v.x+h*a.w.x;f.y=b*a.u.y+d*a.v.y+h*a.w.y;f.z=b*a.u.z+
d*a.v.z+h*a.w.z}};a.getUnitVectors=function(d,e,g,f){d=g-d;e=f-e;f=Math.sqrt(d*d+e*e);return{u:new a.Vector(d/f,e/f),v:new a.Vector(-e/f,d/f),w:0}};a.drawUnitVectors=function(a,e,g,f,c){a.lineWidth=5;a.strokeStyle=c;a.beginPath();a.moveTo(e,g);a.lineTo(e+100*f.u.x,g+100*f.u.y);a.moveTo(e,g);a.lineTo(e+50*f.v.x,g+50*f.v.y);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};a.drawCoordinateVector=function(a,e,g,f,c,b,l){a.lineWidth=5;a.strokeStyle=l;a.beginPath();a.moveTo(e,g);a.lineTo(e+100*c*f.u.x,g+
100*c*f.u.y);a.lineTo(e+100*c*f.u.x+100*b*f.v.x,g+100*c*f.u.y+100*b*f.v.y);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};a.scalarProduct=function(a,e){return a.x*e.x+a.y*e.y};a.VectorProduct=function(d,e){return new a.Vector(d.y*e.z-d.z*e.y,d.z*e.x-d.x*e.z,d.x*e.y-d.y*e.x)}})();if(TEST){var CreJsTest=CreJsTest||{};(function(){(CreJsTest.Core=CreJs.Core||{}).test_Vector_constructor=function(){var a=new CreJs.Core.Vector(1,2,3);return 1!=a.x?"FAILED! vector.x: Expected 1, was "+a.x:2!=a.y?"FAILED! vector.y: Expected 2, was "+a.y:3!=a.z?"FAILED! vector.z: Expected 3, was "+a.z:"OK"}})()};(function(){CreJs.Creanvas.CollisionSolver=function(a){var d=function(a,c){var b,d,h,k,e,g,m;k=a.getClientRect();e=c.getClientRect();b=Math.max(k.left,e.left)-1;d=Math.min(k.right,e.right)+1;h=Math.max(k.top,e.top)-1;k=Math.min(k.bottom,e.bottom)+1;if(!(0>=d-b||0>=k-h)){b=a.collisionContext.getImageData(0,0,a.width,a.height);a.collisionContext.scale(1/(a.scaleX||1),1/(a.scaleY||1));a.collisionContext.rotate(-(a.angle||0));a.collisionContext.translate(c.x-a.x,c.y-a.y);a.collisionContext.rotate(c.angle||
0);a.collisionContext.scale(c.scaleX||1,c.scaleY||1);a.collisionContext.globalCompositeOperation="destination-out";a.collisionContext.drawImage(c.collidedContext.canvas,0,0,c.width,c.height,-c.dx,-c.dy,c.width,c.height);a.collisionContext.scale(1/(c.scaleX||1),1/(c.scaleY||1));a.collisionContext.rotate(-c.angle||0);a.collisionContext.translate(-c.x+a.x,-c.y+a.y);a.collisionContext.rotate(a.angle||0);a.collisionContext.scale(a.scaleX||1,a.scaleY||1);g=a.collisionContext.getImageData(0,0,a.width,a.height);
a.collisionContext.globalCompositeOperation="source-over";a.collisionContext.putImageData(b,0,0);m=[];a.edges.forEach(function(b){90>g.data[b.y*a.width*4+4*b.x+3]&&m.push(b)});if(2>m.length)return null;var n;h=d=0;b=m.length-1;for(k=1;k<m.length;k++)for(e=k+1;e<m.length;e++){n=m[k].x-m[e].x;var p=m[k].y-m[e].y;n=Math.sqrt(n*n+p*p);n>d&&(d=n,h=k,b=e)}d=a.getCanvasXY(m[h].x-a.dx,m[h].y-a.dy);b=a.getCanvasXY(m[b].x-a.dx,m[b].y-a.dy);return d.x==b.x&&d.y==b.y?null:{x:Math.round((d.x+b.x)/2),y:Math.round((d.y+
b.y)/2),vectors:CreJs.Core.getUnitVectors(d.x,d.y,b.x,b.y)}}},e=function(a,c,b){var d,h,k,e,g,m;d=b.vectors;e=new CreJs.Core.Vector(b.x-a.x,b.y-a.y);g=CreJs.Core.VectorProduct(e,d.v).z;m=new CreJs.Core.Vector(b.x-c.x,b.y-c.y);b=CreJs.Core.VectorProduct(m,d.v).z;var n=CreJs.Core.VectorProduct(e,d.v),p=CreJs.Core.VectorProduct(m,d.v);h=new CreJs.Core.Vector(a.moving.speed.x,a.moving.speed.y);k=new CreJs.Core.Vector(c.moving.speed.x,c.moving.speed.y);a.scaleSpeed&&(h.x+=e.x*a.scaleSpeed.x,h.y+=e.y*a.scaleSpeed.y);
c.scaleSpeed&&(k.x+=m.x*c.scaleSpeed.x,k.y+=m.y*c.scaleSpeed.y);e=h.getCoordinates(d);k=k.getCoordinates(d);n=a.collidable.coefficient*c.collidable.coefficient*2*(k.v-e.v+c.moving.rotationSpeed*p.z-a.moving.rotationSpeed*n.z)/(1/c.m+1/a.m+p.z*p.z/c.getM()+n.z*n.z/a.getM());a.moving.speed.x+=n/a.m*d.v.x;a.moving.speed.y+=n/a.m*d.v.y;c.moving.speed.x-=n/c.m*d.v.x;c.moving.speed.y-=n/c.m*d.v.y;a.moving.rotationSpeed+=n*g/a.getM();c.moving.rotationSpeed-=n*b/c.getM()},g=function(){return a.elements.filter(function(a){return a.collidable})};
this.solveCollision=function(a){var c=g(),b,l,h;b=a.getCenter();c=c.filter(function(h){var c;if(h.id===a.id||!(h.moving.speed.x||h.moving.speed.y||a.moving.speed.x||a.moving.speed.y||h.scaleSpeed||a.scaleSpeed))return!1;c=h.getCenter();return Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y))>a.getRadius()+h.getRadius()?!1:!0});if(0==c.length)return!0;l=null;c.forEach(function(b){l||(l=d(a,b))&&(h=b)});if(!l)return!0;e(a,h,l);a.events.dispatch("collision",{element:h,collisionPoint:l});h.events.dispatch("collision",
{element:a,collisionPoint:l});return!1}}})();(function(){CreJs.Creanvas.Controller=function(a){var d,e,g,f,c,b,l;f=this;d=a.canvas;l=a.timeScale||1;a.realTime?(b=Date.now(),this.getTime=function(){return(Date.now()-b)*l}):(c=0,setInterval(function(){c+=10*l},10),this.getTime=function(){return c});this.log=function(b){a.log&&a.log(b)};DEBUG&&this.log("Starting controller");f.context=d.getContext("2d");e=!0;isDrawing=!1;g=a.refreshTime||50;this.triggerPointedElementEvent=function(a,b){var c=!1;f.elements.filter(function(b){return b.canHandle(a)}).sort(function(a,
b){return b.z||0-a.z||0}).forEach(function(d){!c&&d.hit(b.x,b.y)&&(d.events.dispatch(a,b),c=!0)})};this.triggerElementEventByIdentifier=function(a,b){f.elements.forEach(function(c){c.touchIdentifier==b.touchIdentifier&&c.events.dispatch(a,b)})};this.registerCanvasPointerEvent=function(a,b){d.addEventListener(a,function(c){setTimeout(function(){var d=function(c,d){DEBUG&&f.log("Canvas event "+a+" with touchIdentifier "+d);var e=f.getCanvasXYFromClientXY(c);e.touchIdentifier=d;f.triggerPointedElementEvent(b,
e)};if(c.changedTouches)for(var e=0;e<c.changedTouches.length;e++)d(c.changedTouches[e],c.changedTouches[e].identifier);else d(c,-1)})})};this.registerTouchIdentifierEvent=function(a,b){d.addEventListener(a,function(c){setTimeout(function(){var d=function(c,d){DEBUG&&f.log("Canvas event "+a+" with touchIdentifier "+d);var e=f.getCanvasXYFromClientXY(c);e.touchIdentifier=d;f.triggerElementEventByIdentifier(b,e)};if(c.changedTouches)for(var e=0;e<c.changedTouches.length;e++)d(c.changedTouches[e],c.changedTouches[e].identifier);
else d(c,-1)})})};this.events=new CreJs.Creevents.EventContainer;this.registerCanvasPointerEvent("click","click");this.registerCanvasPointerEvent("mousedown","pointerDown");this.registerCanvasPointerEvent("touchstart","pointerDown");this.registerTouchIdentifierEvent("mousemove","pointerMove");this.registerTouchIdentifierEvent("touchmove","pointerMove");this.registerTouchIdentifierEvent("mouseup","pointerUp");this.registerTouchIdentifierEvent("touchend","pointerUp");this.stop=function(){f.events.dispatch("deactivate");
f.elements=[]};this.redraw=function(){e=!0};this.getCanvasXYFromClientXY=function(a){var b=d.getBoundingClientRect();return{x:Math.round((a.clientX-b.left)*d.width/b.width),y:Math.round((a.clientY-b.top)*d.height/b.height)}};f.elements=[];this.addElement=function(){DEBUG&&f.log("Controller.addElement: Adding element - args:"+arguments.length);var a=[].slice.call(arguments),b=new CreJs.Creanvas.Element(f,a[0]);DEBUG&&f.log("Controller.addElement: Created element: "+b.name+"-"+b.id);1<a.length?(DEBUG&&
f.log("Controller.addElement: Applying "+(a.length-1)+" decorators"),b.applyDecorators.apply(b,a.slice(1))):DEBUG&&f.log("Controller.addElement: No decorator to apply");f.elements.push(b);return b};f.log("Adding background");this.addElement({name:"background",image:{width:d.width,height:d.height,translate:{dx:0,dy:0},draw:a.drawBackground||function(b){b.fillStyle=a.backgroundStyle||"#FFF";b.fillRect(0,0,this.width,this.height)}},position:{z:-Infinity}});setInterval(function(){e&&!isDrawing&&(isDrawing=
!0,f.elements.sort(function(a,b){return(a.z||0)-(b.z||0)}).forEach(function(a){f.context.translate(a.x,a.y);f.context.rotate(a.angle||0);f.context.scale(a.scaleX||1,a.scaleY||1);f.context.drawImage(a.temporaryRenderingContext.canvas,0,0,a.width,a.height,-a.dx,-a.dy,a.width,a.height);f.context.scale(1/(a.scaleX||1),1/a.scaleY||1);f.context.rotate(-(a.angle||0));f.context.translate(-a.x,-a.y)}),isDrawing=!1)},g)}})();(function(){CreJs.Creanvas.Element=function(a,d){var e=[].slice.apply(arguments).slice(2),g=[];this.controller=a;this.name=d.name;this.id=CreJs.CreHelpers.GetGuid();this.width=d.image.width;this.height=d.image.height;this.x=d.position.x||0;this.y=d.position.y||0;this.z=d.position.z||0;this.angle=d.position.angle||0;this.scaleX=d.image.scaleX||1;this.scaleY=d.image.scaleY||1;this.m=1;var f=d.image.draw,c=d.image.translate||{dx:d.image.width/2,dy:d.image.height/2};this.dx=c.dx;this.dy=c.dy;d.image.image?
(this.image=d.image.image,c=this.controller.context.canvas,c=c.ownerDocument.createElement("canvas"),this.temporaryRenderingContext=c.getContext("2d"),this.temporaryRenderingContext.putImageData(this.image,0,0)):(c=this.controller.context.canvas,c=c.ownerDocument.createElement("canvas"),c.width=d.image.width,c.height=d.image.height,this.temporaryRenderingContext=c.getContext("2d"),this.temporaryRenderingContext.beginPath(),this.temporaryRenderingContext.translate(this.dx,this.dy),d.image.draw(this.temporaryRenderingContext),
this.image=this.temporaryRenderingContext.getImageData(0,0,d.image.width,d.image.height));var b=this;DEBUG&&(b.debug=function(a,c){b.controller.log("Element."+a+": "+c+". Element: "+b.name+"/"+b.id)});d.rules&&(b.rules=[],d.rules.forEach(function(a){var c=b.rules.length;b.rules.push(a);setInterval(function(){b.rules[c].rule.call(b);b.triggerRedraw()},a.checkTime)}));this.events=new CreJs.Creevents.EventContainer;this.isPointInPath=function(a){a=b.controller.getCanvasXYFromClientXY(a);return b.controller.noDrawContext.isPointInPath(b,
f,a)};0<e.length&&CreJs.Creanvas.elementDecorators&&(DEBUG&&a.log("New element "+d.name+" : apply "+e.length+" decorators"),b.applyDecorators(e));this.hit=function(a,c){var d=Math.round(a-b.x+b.dx),e=Math.round(c-b.y+b.dy);return 0<=d&&d<=b.width&&0<=e&&e<=b.height&&0<b.image.data[4*e*b.width+4*d+3]};this.clone=function(){d.image.image=b.image;DEBUG&&a.log("cloning with elementdefinition: "+d);var c=b.controller.addElement(d);DEBUG&&a.log("Cloning "+c.name+" : apply "+e.length+" decorators");c.applyDecorators.apply(c,
e);return c};this.removeDecorator=function(a){b.events.removeEventListener({eventGroupType:a,listenerId:b.id})};this.canHandle=function(a){return"click"==a||"pointerDown"==a||b.events.hasEvent(a)};this.deactivate=function(){b.controller.events.removeEventListener({listenerId:b.id});b.temporaryRenderingContext=null};b.controller.events.addEventListener({eventId:"deactivate",listenerId:b.id,handleEvent:function(a){b.deactivate()}});this.triggerRedraw=function(){b.controller.redraw()};this.getCanvasXY=
function(a,c){return{x:Math.round(b.x+a*b.scaleX*Math.cos(b.angle)-c*b.scaleY*Math.sin(b.angle)),y:Math.round(b.y+a*b.scaleX*Math.sin(b.angle)+c*b.scaleY*Math.cos(b.angle))}};this.getCanvasXYNoRounding=function(a,c){return{x:b.x+a*b.scaleX*Math.cos(b.angle)-c*b.scaleY*Math.sin(b.angle),y:b.y+a*b.scaleX*Math.sin(b.angle)+c*b.scaleY*Math.cos(b.angle)}};this.getElementXY=function(a,c){return{x:Math.round(((a-b.x)*Math.cos(b.angle)+(c-b.y)*Math.sin(b.angle))/b.scaleX),y:Math.round(((c-b.y)*Math.cos(b.angle)-
(a-b.x)*Math.sin(b.angle))/b.scaleY)}};this.getCenter=function(){return b.getCanvasXY(-b.dx+b.width/2,-b.dy+b.height/2)};var l=[];l.push({x:-b.dx,y:-b.dy});l.push({x:-b.dx+b.width,y:-b.dy});l.push({x:-b.dx+b.width,y:-b.dy+b.height});l.push({x:-b.dx,y:-b.dy+b.height});this.getClientCornersCache=function(){return l.map(function(a){return b.getCanvasXY(a.x,a.y)})};this.getClientCorners=function(){var a=b.x+""+b.y+""+b.angle+""+b.scaleX+""+b.scaleX;if(g.getClientCorners&&g.getClientCorners.key==a)return g.getClientCorners.value;
var c=b.getClientCornersCache();g.getClientCorners={key:a,value:c};return c};this.getClientRectCache=function(){var a=b.getClientCorners();return{top:a.reduce(function(a,b){return Math.min(a,b.y)},Infinity),bottom:a.reduce(function(a,b){return Math.max(a,b.y)},-Infinity),left:a.reduce(function(a,b){return Math.min(a,b.x)},Infinity),right:a.reduce(function(a,b){return Math.max(a,b.x)},-Infinity)}};this.getClientRect=function(){var a=b.x+""+b.y+""+b.angle+""+b.scaleX+""+b.scaleX;if(g.getClientRect&&
g.getClientRect.key==a)return g.getClientRect.value;var c=b.getClientRectCache();g.getClientRect={key:a,value:c};return c};this.applyDecorators=function(){var a=this;DEBUG&&a.debug("applyDecorators","Applying "+arguments.length+" new decorators");e=e.concat([].slice.apply(arguments));DEBUG&&a.debug("applyDecorators","Applying "+e.length+" decorators");e.forEach(function(b){a.applyDecorator(b[0],b[1])})};this.applyDecorator=function(a,b){DEBUG&&this.debug("applyDecorator","Applying decorator "+a);
var c=CreJs.Creanvas.elementDecorators[a];c?c.applyTo(this,b):DEBUG&&this.debug("applyDecorator","Decorator not found: "+a)}}})();CreJs=CreJs||{};(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.clickable={applyTo:function(a,d){a.onClick=function(e){d.onclick.call(a,e);a.triggerRedraw()};a.events.addEventListener({eventId:"click",handleEvent:a.onClick})}}})();CreJs=CreJs||{};
(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.collidable={applyTo:function(a,d){var e=[];a.collidable={};a.controller.collisionSolver=a.controller.collisionSolver||new CreJs.Creanvas.CollisionSolver(a.controller);d.hasOwnProperty("collisionCoefficient")?a.collidable.coefficient=d.collisionCoefficient:a.collidable.coefficient=1;a.moving=a.moving||{speed:new CreJs.Core.Vector(0,0),acceleration:new CreJs.Core.Vector(0,
0),rotationSpeed:0};a.events.addEventListener({eventId:"collision",handleEvent:function(b){d.onCollision&&d.onCollision.call(a,b)}});a.preMove=this.preMove||[];a.preMove.push(function(){return a.controller.collisionSolver.solveCollision(a)});a.getM=function(){return a.m/12*(a.width*a.scaleX*a.width*a.scaleX+a.height*a.scaleY*a.height*a.scaleY)};a.geRadiusCache=function(){return Math.sqrt(a.width*a.width*a.scaleX*a.scaleX+a.height*a.height*a.scaleY*a.scaleY)/2};a.getRadius=function(){var b=a.width+
""+a.height+""+a.scaleX+""+a.scaleY;if(e.getRadius&&e.getRadius.key==b)return e.getRadius.value;var c=a.geRadiusCache();e.geRadius={key:b,value:c};return c};var g=a.controller.context.canvas,f=g.ownerDocument.createElement("canvas"),g=g.ownerDocument.createElement("canvas");f.width=g.width=a.width;f.height=g.height=a.height;a.collidedContext=g.getContext("2d");a.collidedContext.putImageData(a.image,0,0);a.collidedContext.globalCompositeOperation="source-atop";a.collidedContext.fillStyle="#000";a.collidedContext.fillRect(0,
0,a.width,a.height);a.collisionContext=f.getContext("2d");a.collisionContext.globalCompositeOperation="source-over";a.collisionContext.drawImage(a.collidedContext.canvas,0,0);f=a.collisionContext.getImageData(0,0,a.width,a.height);g=a.collisionContext.createImageData(a.width,a.height);a.edges=[];for(var c=0;c<a.width;c++)for(var b=0;b<a.height;b++)if(!(200>f.data[b*a.width*4+4*c+3])){for(var l=!1,h=-1;2>h;h++)for(var k=-1;2>k;k++)if(0>b+h||0>c+k||b+h>a.height-1||c+h>a.width-1||100>f.data[(b+h)*a.width*
4+4*(c+k)+3])l=!0,k=h=2;a.collisionContext.putImageData(g,0,0);l&&(a.edges.push({x:c,y:b}),g.data[b*a.width*4+4*c]=0,g.data[b*a.width*4+4*c+1]=0,g.data[b*a.width*4+4*c+2]=0,g.data[b*a.width*4+4*c+3]=255)}a.collisionContext.putImageData(g,0,0);a.collisionContext.translate(a.dx,a.dy)}}})();CreJs=CreJs||{};(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.droppable={applyTo:function(a,d){a.isDroppable=!0;a.dropZone=d.dropZone;DEBUG&&a.controller.log("Now droppable: "+a.id)}}})();CreJs=CreJs||{};
(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.dropzone={applyTo:function(a,d){var e=d.availableSpots,g=d.dropX,f=d.dropY;a.droppedElements=[];a.events.addEventListener({eventGroupType:"dropzone",eventId:"drop",handleEvent:function(c){0>=e||(DEBUG&&a.controller.log("drop event on dropzone "+a.id+", dropped "+c.droppedElement.id),e--,c.droppedElement.x=g||a.x,c.droppedElement.y=f||a.y,c.droppedElement.dropZone=
a,a.droppedElements.push(c.droppedElement),c.droppedElement.events.dispatch("dropped",{dropZone:a,droppedElement:c.droppedElement}),a.events.dispatch("droppedIn",{dropZone:a,droppedElement:c.droppedElement}),a.triggerRedraw())},listenerId:a.id});a.drag=function(c){DEBUG&&a.controller.log("dragging from dropzone "+a.id+", dragged "+c.id);c.dropZone=null;e++;a.droppedElements.splice(a.droppedElements.indexOf(c),1);a.triggerRedraw()}}}})();CreJs=CreJs||{};
(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.duplicable={applyTo:function(a,d){var e=d.isBlocked,g=d.hasOwnProperty("generatorCount")?d.generatorCount:Infinity;d.generatorCount=0;var f=!1;a.events.addEventListener({eventGroupType:"duplicable",eventId:"pointerDown",handleEvent:function(c){0<=c.touchIdentifier&&(f=!0);if(!(f&&0>c.touchIdentifier||e&&e()||0>=g)){DEBUG&&a.controller.log("pointereDown event on duplicable "+a.id+
", count id  "+g);g--;var b=a.clone();b.name+=" (duplicate)";b.removeDecorator("duplicable");b.applyDecorators(["movable",{isBlocked:d.isBlocked}]);b.startMoving(c);a.triggerRedraw()}},listenerId:a.id})}}})();(function(){CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[]})();CreJs=CreJs||{};
(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.movable={applyTo:function(a,d){var e=!1,g=this.touchIdentifier=null,f=d.isBlocked;a.startMoving=function(b){DEBUG&&a.controller.log("Starting moving - identifier: "+b.touchIdentifier);e=!0;a.touchIdentifier=b.touchIdentifier;g={x:b.x,y:b.y};a.dropZone&&(a.dropZone.drag(a),a.dropZone=null)};a.moveCompleted=function(b){DEBUG&&a.controller.log("Completed move - identifier: "+b.touchIdentifier);
e=!1;g=null;a.isDroppable&&(DEBUG&&a.controller.log("Trigger drop - identifier: "+b.touchIdentifier),a.controller.triggerPointedElementEvent("drop",{x:b.x,y:b.y,droppedElement:a}))};a.events.addEventListener({eventGroupType:"movable",eventId:"pointerDown",handleEvent:function(b){f&&f()||a.startMoving(b)},listenerId:a.id});var c=!1;a.events.addEventListener({eventGroupType:"movable",eventId:"pointerMove",handleEvent:function(b){!e||f&&f()||(c||(c=!0,DEBUG&&a.controller.log("pointereMove event on movable "+
a.id+" ("+a.touchIdentifier+")")),a.x+=b.x-g.x,a.y+=b.y-g.y,g={x:b.x,y:b.y},a.triggerRedraw())},listenerId:a.id});a.events.addEventListener({eventGroupType:"movable",eventId:"pointerUp",handleEvent:function(b){!e||f&&f()||(DEBUG&&a.controller.log("End detected for touch "+a.touchIdentifier),a.controller.getCanvasXYFromClientXY(b),a.x+=b.x-g.x,a.y+=b.y-g.y,a.moveCompleted(b),a.touchIdentifier=null,c=!1,a.triggerRedraw())},listenerId:a.id})}}})();CreJs=CreJs||{};
(function(){CreJs.Creanvas=CreJs.Creanvas||{};CreJs.Creanvas.elementDecorators=CreJs.Creanvas.elementDecorators||[];CreJs.Creanvas.elementDecorators.moving={type:"moving",applyTo:function(a,d){var e,g,f,c,b;DEBUG&&a.controller.log("Applying moving decorator to "+a.name+"-"+a.id);var l,h,k;a.moving=a.moving||{};a.moving.speed=new CreJs.Core.Vector(d.vx||0,d.vy||0);a.moving.acceleration=new CreJs.Core.Vector(d.ax||0,d.ay||0);a.moving.rotationSpeed=d.omega||0;l=a.controller.getTime();setInterval(function(){h=
a.controller.getTime();k=h-l;if(!(1>k)&&(l=h,a.moving.speed.x+=a.moving.acceleration.x*k,a.moving.speed.y+=a.moving.acceleration.y*k,0!=a.moving.speed.x||0!=a.moving.speed.y||0!=a.moving.rotationSpeed||a.scaleSpeed&&(0!=a.scaleSpeed.x||0!=a.scaleSpeed.y))){e=a.x;g=a.y;f=a.angle;c=a.scaleX;b=a.scaleY;a.x+=a.moving.speed.x*k;a.y+=a.moving.speed.y*k;a.angle+=a.moving.rotationSpeed*k;a.scaleSpeed&&(a.scaleX+=a.scaleSpeed.x*k,a.scaleY+=a.scaleSpeed.y*k);var d=!0;a.preMove&&a.preMove.forEach(function(b){d&&
(b.call(a)||(d=!1))});d||(a.x=e,a.y=g,a.angle=f,a.scaleX=c,a.scaleY=b)}},20)}}})();(function(){var a;(CreJs.Creevents=CreJs.Creevents||{}).Event=function(d){this.eventId=d;a=CreJs.CreHelpers;var e=[],g=new CreJs.Crelog.Logger;this.dispatch=function(f,c){var b=a.GetGuid(),l=e.length;DEBUG&&f&&"pointerMove"!=f.eventId&&"drag"!=f.eventId&&"drop"!=f.eventId&&g.log("Dispatching "+l+" "+f.eventId+". ("+b+")");e.forEach(function(a){a.debugEvent=d;setTimeout(function(){DEBUG&&f&&"pointerMove"!=f.eventId&&"drag"!=f.eventId&&"drop"!=f.eventId&&g.log("Actually handling "+f.eventId+". ("+b+
")");a.handleEvent(f);l--;0==l&&c&&c()})})};this.addEventListener=function(d){var c=a.GetGuid();e.push({handlerGuid:c,handleEvent:d.handleEvent,rank:d.rank,listenerId:d.listenerId,eventGroupType:d.eventGroupType});e=e.sort(function(a,c){return(a.rank||Infinity)-(c.rank||Infinity)});return c};this.removeEventListener=function(a){e=e.filter(function(c){return Boolean(a.handlerGuid)&&c.handlerGuid!=a.handlerGuid||Boolean(a.listenerId)&&c.listenerId!=a.listenerId||Boolean(a.eventGroupType)&&c.eventGroupType!=
a.eventGroupType})}};CreJs.Creevents=CreJs.Creevents})();(function(){var a=CreJs.Creevents=CreJs.Creevents||{};a.EventContainer=function(){var d=this,e={},g=[];this.hasEvent=function(a){return void 0!=e[a]};var f=function(c){g.push(c);e[c]=new a.Event(c)};this.addEventListener=function(a){e[a.eventId]||f(a.eventId);return e[a.eventId].addEventListener(a)};this.dispatch=function(a,b,d){e[a]&&(b&&(b.eventId=a),e[a].dispatch(b,d))};this.removeEventListener=function(a){e[a.eventId]?e[a.eventId].removeEventListener(a):g.forEach(function(b){e[b].removeEventListener(a)})};
this.registerControlEvent=function(a,b,g){e[g]||f(g);a.addEventListener(b,function(a){a.preventDefault();setTimeout(function(){d.dispatch(g,a)},0)})}}})();(function(){var a=CreJs.CreHelpers=CreJs.CreHelpers||{};a.GetGuid=function(){var d=Date.now().toString(16),d=a.repeatString("x",15-d.length)+d;return("xxxxxxxx-xxxx-4xxx-y"+d.slice(0,3)+"-"+d.slice(3)).replace(/[xy]/g,function(a){var d=16*Math.random()|0;return("x"==a?d:d&3|8).toString(16)})};a.repeatString=function(d,e){return 0>=e?"":d+a.repeatString(d,e-1)};CreJs.CreHelpers=CreJs.CreHelpers})();(function(){(CreJs.Crelog=CreJs.Crelog||{}).Logger=function(){this.log=function(a){console.log(a)}}})();
