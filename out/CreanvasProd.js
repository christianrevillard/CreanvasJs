var d=d||{};window.CreJs=d;d.a=d.a||{};d.Creanvas=d.a;d.a.aa=d.a.aa||{};d.a.ElementDecorators=d.a.aa;d.L=d.L||{};d.Crelog=d.L;d.A=d.A||{};d.Creevents=d.A;d.J=d.J||{};d.CreHelpers=d.J;d=d||{};
(function(){var a=d.n=d.n||{};a.r=function(c,e,g){var f=this;this.x=c;this.y=e;this.z=g||0;this.U=function(a,c,e,m){a.lineWidth=5;a.strokeStyle=m;a.beginPath();a.moveTo(c,e);a.lineTo(c+100*f.x,e+100*f.y);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};this.ha=function(b){return{G:a.$(f,b.G),k:a.$(f,b.k),ma:a.$(f,b.ma)}}};a.Ca=function(c,e,g,f){c=g-c;e=f-e;f=Math.sqrt(c*c+e*e);return{G:new a.r(c/f,e/f),k:new a.r(-e/f,c/f),ma:0}};a.Ya=function(a,e,g,f,b){a.lineWidth=5;a.strokeStyle=b;a.beginPath();a.moveTo(e,
g);a.lineTo(e+100*f.G.x,g+100*f.G.y);a.moveTo(e,g);a.lineTo(e+50*f.k.x,g+50*f.k.y);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};a.Xa=function(a,e,g,f,b,h,k){a.lineWidth=5;a.strokeStyle=k;a.beginPath();a.moveTo(e,g);a.lineTo(e+100*b*f.G.x,g+100*b*f.G.y);a.lineTo(e+100*b*f.G.x+100*h*f.k.x,g+100*b*f.G.y+100*h*f.k.y);a.stroke();a.lineWidth=1;a.strokeStyle="#000"};a.$=function(a,e){return a.x*e.x+a.y*e.y};a.M=function(c,e){return new a.r(c.y*e.z-c.z*e.y,c.z*e.x-c.x*e.z,c.x*e.y-c.y*e.x)}})();d=d||{};d.a=d.a||{};
d.a.na=function(a){function c(){return a.elements.filter(function(a){return a.N})}function e(a,b,c){var e,m,l,g,r,n;e=c.Na;g=new d.n.r(c.x-a.x,c.y-a.y);r=d.n.M(g,e.k).z;n=new d.n.r(c.x-b.x,c.y-b.y);c=d.n.M(n,e.k).z;var p=d.n.M(g,e.k),q=d.n.M(n,e.k);m=new d.n.r(a.b.speed.x,a.b.speed.y);l=new d.n.r(b.b.speed.x,b.b.speed.y);a.p&&(m.x+=g.x*a.p.x,m.y+=g.y*a.p.y);b.p&&(l.x+=n.x*b.p.x,l.y+=n.y*b.p.y);g=a.N.ca*b.N.ca*2*(l.ha(e).k-m.ha(e).k+b.b.w*q.z-a.b.w*p.z)/(1/b.H+1/a.H+q.z*q.z/b.Q()+p.z*p.z/a.Q());a.b.speed.x+=
g/a.H*e.k.x;a.b.speed.y+=g/a.H*e.k.y;b.b.speed.x-=g/b.H*e.k.x;b.b.speed.y-=g/b.H*e.k.y;a.b.w+=g*r/a.Q();b.b.w-=g*c/b.Q()}function g(a,b){var c,e,m,l,g,r,n;l=a.ga();g=b.ga();c=Math.max(l.left,g.left)-1;e=Math.min(l.right,g.right)+1;m=Math.max(l.top,g.top)-1;l=Math.min(l.bottom,g.bottom)+1;if(!(0>=e-c||0>=l-m)){c=a.e.getImageData(0,0,a.width,a.height);a.e.scale(1/(a.g||1),1/(a.i||1));a.e.rotate(-(a.j||0));a.e.translate(b.x-a.x,b.y-a.y);a.e.rotate(b.j||0);a.e.scale(b.g||1,b.i||1);a.e.globalCompositeOperation=
"destination-out";a.e.drawImage(b.K.canvas,0,0,b.width,b.height,-b.l,-b.m,b.width,b.height);a.e.scale(1/(b.g||1),1/(b.i||1));a.e.rotate(-b.j||0);a.e.translate(-b.x+a.x,-b.y+a.y);a.e.rotate(a.j||0);a.e.scale(a.g||1,a.i||1);r=a.e.getImageData(0,0,a.width,a.height);a.e.globalCompositeOperation="source-over";a.e.putImageData(c,0,0);n=[];a.ea.forEach(function(b){90>r.data[b.y*a.width*4+4*b.x+3]&&n.push(b)});if(2>n.length)return null;var p;m=e=0;c=n.length-1;for(l=1;l<n.length;l++)for(g=l+1;g<n.length;g++){p=
n[l].x-n[g].x;var q=n[l].y-n[g].y;p=Math.sqrt(p*p+q*q);p>e&&(e=p,m=l,c=g)}e=a.O(n[m].x-a.l,n[m].y-a.m);c=a.O(n[c].x-a.l,n[c].y-a.m);return e.x==c.x&&e.y==c.y?null:{x:Math.round((e.x+c.x)/2),y:Math.round((e.y+c.y)/2),Na:d.n.Ca(e.x,e.y,c.x,c.y)}}}this.La=function(a){var b=c(),h,k,m;h=a.fa();b=b.filter(function(b){var c;if(b.id===a.id||!(b.b.speed.x||b.b.speed.y||a.b.speed.x||a.b.speed.y||b.p||a.p))return!1;c=b.fa();return Math.sqrt((h.x-c.x)*(h.x-c.x)+(h.y-c.y)*(h.y-c.y))>a.ia()+b.ia()?!1:!0});if(0==
b.length)return!0;k=null;b.forEach(function(b){k||(k=g(a,b))&&(m=b)});if(!k)return!0;e(a,m,k);a.h.v("collision",{element:m,ua:k});m.h.v("collision",{element:a,ua:k});return!1}};d=d||{};d.a=d.a||{};
d.a.Oa=function(a){var c,e,g,f,b,h,k;f=this;c=a.canvas;k=a.hb||1;a.eb?(h=Date.now(),this.getTime=function(){return(Date.now()-h)*k}):(b=0,setInterval(function(){b+=10*k},10),this.getTime=function(){return b});this.log=function(b){a.log&&a.log(b)};this.log("Starting controller");f.s=c.getContext("2d");e=!0;isDrawing=!1;g=a.fb||50;this.la=function(a,b){var c=!1;f.elements.filter(function(b){return b.sa(a)}).sort(function(a,b){return b.z||0-a.z||0}).forEach(function(f){!c&&f.Ea(b.x,b.y)&&(f.h.v(a,b),
c=!0)})};this.Ma=function(a,b){f.elements.forEach(function(c){c.o==b.o&&c.h.v(a,b)})};this.Z=function(a,b){c.addEventListener(a,function(c){setTimeout(function(){function e(c,g){f.log("Canvas event "+a+" with touchIdentifier "+g);var h=f.P(c);h.o=g;f.la(b,h)}if(c.changedTouches)for(var g=0;g<c.changedTouches.length;g++)e(c.changedTouches[g],c.changedTouches[g].identifier);else e(c,-1)})})};this.S=function(a,b){c.addEventListener(a,function(c){setTimeout(function(){function e(c,g){f.log("Canvas event "+
a+" with touchIdentifier "+g);var h=f.P(c);h.o=g;f.Ma(b,h)}if(c.changedTouches)for(var g=0;g<c.changedTouches.length;g++)e(c.changedTouches[g],c.changedTouches[g].identifier);else e(c,-1)})})};this.h=new d.A.ba;this.Z("click","click");this.Z("mousedown","pointerDown");this.Z("touchstart","pointerDown");this.S("mousemove","pointerMove");this.S("touchmove","pointerMove");this.S("mouseup","pointerUp");this.S("touchend","pointerUp");this.stop=function(){f.h.v("deactivate");f.elements=[]};this.Ja=function(){e=
!0};this.P=function(a){var b=c.getBoundingClientRect();return{x:Math.round((a.clientX-b.left)*c.width/b.width),y:Math.round((a.clientY-b.top)*c.height/b.height)}};f.elements=[];this.addElement=function(a){a.c=f;a=new d.a.oa(a);f.elements.push(a);return a};this.addElement({name:"background",width:c.width,height:c.height,translate:{l:0,m:0},U:a.Wa||function(b){b.fillStyle=a.Sa||"#FFF";b.fillRect(0,0,this.width,this.height)},z:-Infinity});setInterval(function(){e&&!isDrawing&&(isDrawing=!0,f.elements.sort(function(a,
b){return(a.z||0)-(b.z||0)}).forEach(function(a){f.s.translate(a.x,a.y);f.s.rotate(a.j||0);f.s.scale(a.g||1,a.i||1);f.s.drawImage(a.F.canvas,0,0,a.width,a.height,-a.l,-a.m,a.width,a.height);f.s.scale(1/(a.g||1),1/a.i||1);f.s.rotate(-(a.j||0));f.s.translate(-a.x,-a.y)}),isDrawing=!1)},g)};d=d||{};
(function(){var a=d.a=d.a||{};a.oa=function(c){if(c.hasOwnProperty("controller")&&c.hasOwnProperty("draw")){var e=[];this.c=c.c;this.x=c.x||0;this.y=c.y||0;this.z=c.z||0;this.id=d.J.T();this.name=c.name;this.width=c.width;this.height=c.height;this.j=c.j||0;this.g=c.g||1;this.i=c.i||1;this.H=1;var g=c.U,f=c.translate||{l:c.width/2,m:c.height/2};this.l=f.l;this.m=f.m;c.D?(this.D=c.D,f=this.c.s.canvas,f=f.ownerDocument.createElement("canvas"),this.F=f.getContext("2d"),this.F.putImageData(this.D,0,0)):
(f=this.c.s.canvas,f=f.ownerDocument.createElement("canvas"),f.width=c.width,f.height=c.height,this.F=f.getContext("2d"),this.F.beginPath(),this.F.translate(this.l,this.m),c.U(this.F),this.D=this.F.getImageData(0,0,c.width,c.height));this.Q=function(){return b.H/12*(b.width*b.g*b.width*b.g+b.height*b.i*b.height*b.i)};this.xa=function(){return Math.sqrt(b.width*b.width*b.g*b.g+b.height*b.height*b.i*b.i)/2};this.ia=function(){var a=b.width+""+b.height+""+b.g+""+b.i;if(e.getRadius&&e.getRadius.key==
a)return e.getRadius.value;var c=b.xa();e.geRadius={key:a,value:c};return c};var b=this;c.rules&&(b.rules=[],c.rules.forEach(function(a){var c=b.rules.length;b.rules.push(a);setInterval(function(){b.rules[c].gb.call(b);b.I()},a.Ta)}));this.h=new d.A.ba;this.isPointInPath=function(a){a=b.c.P(a);return b.c.bb.isPointInPath(b,g,a)};if(d.a.d)for(f=0;f<a.d.length;f++){var h=d.a.d[f];c.hasOwnProperty(h.type)&&c[h.type]&&h.B(b,c[h.type])}this.Ea=function(a,c){var f=Math.round(a-b.x+b.l),e=Math.round(c-b.y+
b.m);return 0<=f&&f<=b.width&&0<=e&&e<=b.height&&0<b.D.data[4*e*b.width+4*f+3]};this.ta=function(){c.D=b.D;return b.c.addElement(c)};this.ra=function(a,c){a.B(b,c)};this.Ka=function(){b.h.removeEventListener({u:"duplicable",q:b.id})};this.sa=function(a){return"click"==a||"pointerDown"==a||b.h.Da(a)};this.va=function(){b.c.h.removeEventListener({q:b.id});b.F=null};b.c.h.addEventListener({f:"deactivate",q:b.id,handleEvent:function(){b.va()}});this.I=function(){b.c.Ja()};this.O=function(a,c){return{x:Math.round(b.x+
a*b.g*Math.cos(b.j)-c*b.i*Math.sin(b.j)),y:Math.round(b.y+a*b.g*Math.sin(b.j)+c*b.i*Math.cos(b.j))}};this.fa=function(){return b.O(-b.l+b.width/2,-b.m+b.height/2)};var k=[];k.push({x:-b.l,y:-b.m});k.push({x:-b.l+b.width,y:-b.m});k.push({x:-b.l+b.width,y:-b.m+b.height});k.push({x:-b.l,y:-b.m+b.height});this.za=function(){return k.map(function(a){return b.O(a.x,a.y)})};this.ya=function(){var a=b.x+""+b.y+""+b.j+""+b.g+""+b.g;if(e.getClientCorners&&e.getClientCorners.key==a)return e.getClientCorners.value;
var c=b.za();e.getClientCorners={key:a,value:c};return c};this.Aa=function(){var a=b.ya();return{top:a.reduce(function(a,b){return Math.min(a,b.y)},Infinity),bottom:a.reduce(function(a,b){return Math.max(a,b.y)},-Infinity),left:a.reduce(function(a,b){return Math.min(a,b.x)},Infinity),right:a.reduce(function(a,b){return Math.max(a,b.x)},-Infinity)}};this.ga=function(){var a=b.x+""+b.y+""+b.j+""+b.g+""+b.g;if(e.getClientRect&&e.getClientRect.key==a)return e.getClientRect.value;var c=b.Aa();e.getClientRect=
{key:a,value:c};return c}}}})();d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];d.a.d.push({type:"clickable",B:function(a,c){a.Ha=function(e){c.onclick.call(a,e);a.I()};a.h.addEventListener({f:"click",handleEvent:a.Ha})}});d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];
d.a.d.push({type:"collidable",B:function(a,c){a.N={};a.c.da=a.c.da||new d.a.na(a.c);a.N.ca=c.hasOwnProperty("collisionCoefficient")?c.Ua:1;a.b=a.b||{speed:new d.n.r(0,0),acceleration:new d.n.r(0,0),w:0};a.h.addEventListener({f:"collision",handleEvent:function(b){c.Ia&&c.Ia.call(a,b)}});a.R=this.R||[];a.R.push(function(){return a.c.da.La(a)});var e=a.c.s.canvas,g=e.ownerDocument.createElement("canvas"),e=e.ownerDocument.createElement("canvas");g.width=e.width=a.width;g.height=e.height=a.height;a.K=
e.getContext("2d");a.K.putImageData(a.D,0,0);a.K.globalCompositeOperation="source-atop";a.K.fillStyle="#000";a.K.fillRect(0,0,a.width,a.height);a.e=g.getContext("2d");a.e.globalCompositeOperation="source-over";a.e.drawImage(a.K.canvas,0,0);g=a.e.getImageData(0,0,a.width,a.height);e=a.e.createImageData(a.width,a.height);a.ea=[];for(var f=0;f<a.width;f++)for(var b=0;b<a.height;b++)if(!(200>g.data[b*a.width*4+4*f+3])){for(var h=!1,k=-1;2>k;k++)for(var m=-1;2>m;m++)if(0>b+k||0>f+m||b+k>a.height-1||f+
k>a.width-1||100>g.data[(b+k)*a.width*4+4*(f+m)+3])h=!0,m=k=2;a.e.putImageData(e,0,0);h&&(a.ea.push({x:f,y:b}),e.data[b*a.width*4+4*f]=0,e.data[b*a.width*4+4*f+1]=0,e.data[b*a.width*4+4*f+2]=0,e.data[b*a.width*4+4*f+3]=255)}a.e.putImageData(e,0,0);a.e.translate(a.l,a.m)}});d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];d.a.d.push({type:"droppable",B:function(a,c){a.Fa=!0;a.C=c.C;a.c.log("Now droppable: "+a.id)}});d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];d.a.d.push({type:"dropzone",B:function(a,c){var e=c.Pa,g=c.Za,f=c.$a;a.V=[];a.h.addEventListener({u:"dropzone",f:"drop",handleEvent:function(b){0>=e||(a.c.log("drop event on dropzone "+a.id+", dropped "+b.t.id),e--,b.t.x=g||a.x,b.t.y=f||a.y,b.t.C=a,a.V.push(b.t),b.t.h.v("dropped",{C:a,t:b.t}),a.h.v("droppedIn",{C:a,t:b.t}),a.I())},q:a.id});a.wa=function(b){a.c.log("dragging from dropzone "+a.id+", dragged "+b.id);b.C=null;e++;a.V.splice(a.V.indexOf(b),1);a.I()}}});d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];d.a.d.push({type:"duplicable",B:function(a,c){var e=c.X,g=c.hasOwnProperty("generatorCount")?c.ab:Infinity,f=!1;a.h.addEventListener({u:"duplicable",f:"pointerDown",handleEvent:function(b){0<=b.o&&(f=!0);if(!(f&&0>b.o||e&&e()||0>=g)){a.c.log("pointereDown event on duplicable "+a.id+", count id  "+g);g--;var h=a.ta();h.name+=" (duplicate)";h.Ka();h.ra(d.a.Ba(),{X:c.X});h.ka(b);a.I()}},q:a.id})}});d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];d.a.Ba=function(){var a=d.a.d.filter(function(a){return"movable"==a.type});return 0==a.length?null:a[0]};d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];
d.a.d.push({type:"movable",B:function(a,c){var e=!1,g=this.o=null,f=c.X;a.ka=function(b){a.c.log("Starting moving - identifier: "+b.o);e=!0;a.o=b.o;g={x:b.x,y:b.y};a.C&&(a.C.wa(a),a.C=null)};a.Ga=function(b){a.c.log("Completed move - identifier: "+b.o);e=!1;g=null;a.Fa&&(a.c.log("Trigger drop - identifier: "+b.o),a.c.la("drop",{x:b.x,y:b.y,t:a}))};a.h.addEventListener({u:"movable",f:"pointerDown",handleEvent:function(b){f&&f()||a.ka(b)},q:a.id});var b=!1;a.h.addEventListener({u:"movable",f:"pointerMove",
handleEvent:function(c){!e||f&&f()||(b||(b=!0,a.c.log("pointereMove event on movable "+a.id+" ("+a.o+")")),a.x+=c.x-g.x,a.y+=c.y-g.y,g={x:c.x,y:c.y},a.I())},q:a.id});a.h.addEventListener({u:"movable",f:"pointerUp",handleEvent:function(c){!e||f&&f()||(a.c.log("End detected for touch "+a.o),a.c.P(c),a.x+=c.x-g.x,a.y+=c.y-g.y,a.Ga(c),a.o=null,b=!1,a.I())},q:a.id})}});d=d||{};d.a=d.a||{};d.a.d=d.a.d||[];
d.a.d.push({type:"moving",B:function(a,c){var e,g,f,b,h,k,m,l;a.b=a.b||{};a.b.speed=new d.n.r(c.ib||0,c.jb||0);a.b.acceleration=new d.n.r(c.Qa||0,c.Ra||0);a.b.w=c.cb||0;k=a.c.getTime();setInterval(function(){m=a.c.getTime();l=m-k;if(!(1>l)&&(k=m,a.b.speed.x+=a.b.acceleration.x*l,a.b.speed.y+=a.b.acceleration.y*l,0!=a.b.speed.x||0!=a.b.speed.y||0!=a.b.w||a.p&&(0!=a.p.x||0!=a.p.y))){e=a.x;g=a.y;f=a.j;b=a.g;h=a.i;a.x+=a.b.speed.x*l;a.y+=a.b.speed.y*l;a.j+=a.b.w*l;a.p&&(a.g+=a.p.x*l,a.i+=a.p.y*l);var c=
!0;a.R&&a.R.forEach(function(b){c&&(b.call(a)||(c=!1))});c||(a.x=e,a.y=g,a.j=f,a.g=b,a.i=h)}},20)}});d=d||{};
(function(){var a;(d.A=d.A||{}).pa=function(c){this.f=c;a=d.J;var e=[],g=new d.L.qa;this.v=function(f,b){var h=a.T(),k=e.length;f&&"pointerMove"!=f.f&&"drag"!=f.f&&"drop"!=f.f&&g.log("Dispatching "+k+" "+f.f+". ("+h+")");e.forEach(function(a){a.Va=c;setTimeout(function(){f&&"pointerMove"!=f.f&&"drag"!=f.f&&"drop"!=f.f&&g.log("Actually handling "+f.f+". ("+h+")");a.handleEvent(f);k--;0==k&&b&&b()})})};this.addEventListener=function(c){var b=a.T();e.push({W:b,handleEvent:c.handleEvent,Y:c.Y,q:c.q,u:c.u});
e=e.sort(function(a,b){return(a.Y||Infinity)-(b.Y||Infinity)});return b};this.removeEventListener=function(a){e=e.filter(function(b){return Boolean(a.W)&&b.W!=a.W||Boolean(a.q)&&b.q!=a.q||Boolean(a.u)&&b.u!=a.u})}}})();d=d||{};(function(){var a=d.A=d.A||{};a.ba=function(){var c={},e=[];this.Da=function(a){return void 0!=c[a]};this.addEventListener=function(g){if(!c[g.f]){var f=g.f;e.push(f);c[f]=new a.pa(f)}return c[g.f].addEventListener(g)};this.v=function(a,e,b){c[a]&&(e&&(e.f=a),c[a].v(e,b))};this.removeEventListener=function(a){c[a.f]?c[a.f].removeEventListener(a):e.forEach(function(e){c[e].removeEventListener(a)})}}})();d=d||{};(function(){var a=d.J=d.J||{};a.T=function(){var c=Date.now().toString(16),c=a.ja("x",15-c.length)+c;return("xxxxxxxx-xxxx-4xxx-y"+c.slice(0,3)+"-"+c.slice(3)).replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})};a.ja=function(c,e){return 0>=e?"":c+a.ja(c,e-1)}})();d=d||{};(d.L=d.L||{}).qa=function(){this.log=function(){}};
